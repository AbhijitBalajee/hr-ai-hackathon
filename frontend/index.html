<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillsVoyage - PSA Career Development</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 25%, #2d2d2d 50%, #404040 75%, #1a1a1a 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.2);
        }
        .progress-ring {
            transform: rotate(-90deg);
            transition: stroke-dashoffset 1s ease-in-out;
        }
        .skill-badge {
            transition: all 0.2s;
        }
        .skill-badge:hover {
            transform: scale(1.05);
        }
        .psa-accent {
            color: #00a8e1;
        }
        .psa-accent-bg {
            background-color: #00a8e1;
        }
        .page-transition {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .page-hidden {
            opacity: 0;
            transform: translateX(20px);
            pointer-events: none;
            position: absolute;
        }
        .page-visible {
            opacity: 1;
            transform: translateX(0);
        }
        .week-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .week-card:hover {
            transform: translateX(8px);
            border-left-width: 6px;
        }
        /* Dark Mode Styles */
        body.dark {
            background-color: #0f172a !important;
            color: #e2e8f0;
        }
        .dark .bg-gray-50 {
            background-color: #1e293b !important;
        }
        .dark .bg-white {
            background-color: #1e293b !important;
        }
        .dark .text-gray-800 {
            color: #e2e8f0 !important;
        }
        .dark .text-gray-700 {
            color: #cbd5e1 !important;
        }
        .dark .text-gray-600 {
            color: #94a3b8 !important;
        }
        .dark .text-gray-500 {
            color: #64748b !important;
        }
        .dark .text-gray-400 {
            color: #94a3b8 !important;
        }
        .dark .text-gray-300 {
            color: #cbd5e1 !important;
        }
        .dark .border-gray-300 {
            border-color: #334155 !important;
        }
        .dark .border-gray-200 {
            border-color: #334155 !important;
        }
        .dark .bg-gray-100 {
            background-color: #334155 !important;
        }
        .dark .bg-gray-200 {
            background-color: #475569 !important;
        }
        .dark input, .dark select, .dark textarea {
            background-color: #334155 !important;
            color: #e2e8f0 !important;
            border-color: #475569 !important;
        }
        .dark .from-gray-50 {
            --tw-gradient-from: #1e293b !important;
        }
        .dark .to-gray-100 {
            --tw-gradient-to: #334155 !important;
        }
        .dark .to-gray-200 {
            --tw-gradient-to: #475569 !important;
        }
        .dark .from-gray-100 {
            --tw-gradient-from: #334155 !important;
        }
        /* Dark mode for gradient backgrounds */
        .dark .from-purple-50 {
            --tw-gradient-from: #312e81 !important;
        }
        .dark .to-pink-50 {
            --tw-gradient-to: #831843 !important;
        }
        .dark .from-green-50 {
            --tw-gradient-from: #064e3b !important;
        }
        .dark .to-emerald-50 {
            --tw-gradient-to: #065f46 !important;
        }
        .dark .from-orange-50 {
            --tw-gradient-from: #7c2d12 !important;
        }
        .dark .to-amber-50 {
            --tw-gradient-to: #78350f !important;
        }
        .dark .from-blue-50 {
            --tw-gradient-from: #1e3a8a !important;
        }
        .dark .to-indigo-50 {
            --tw-gradient-to: #312e81 !important;
        }
        /* Preserve gradient cards */
        .dark .from-gray-800 {
            --tw-gradient-from: #1f2937 !important;
        }
        .dark .to-gray-900 {
            --tw-gradient-to: #111827 !important;
        }
        .dark .from-red-500, .dark .from-yellow-500, .dark .from-green-500,
        .dark .from-purple-500, .dark .from-blue-600, .dark .to-indigo-700 {
            /* Keep original vibrant colors for accent gradients */
        }
        #darkModeToggle {
            transition: transform 0.3s ease;
        }
        #darkModeToggle:hover {
            transform: scale(1.1);
        }
        /* Resume Upload Styles */
        .upload-area {
            border: 3px dashed #cbd5e1;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #6366f1;
            background-color: #f0f9ff;
        }
        .upload-area.dragover {
            border-color: #4f46e5;
            background-color: #e0f2fe;
        }
        /* Forum Styles */
        .forum-post {
            transition: all 0.2s ease;
        }
        .forum-post:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        .reply-indent {
            margin-left: 2rem;
            border-left: 3px solid #e5e7eb;
            padding-left: 1rem;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header with PSA Branding -->
    <div class="gradient-bg text-white shadow-2xl">
        <div class="container mx-auto px-6 py-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <i class="fas fa-ship text-6xl psa-accent"></i>
                    <div>
                        <h1 class="text-5xl font-bold">SkillsVoyage</h1>
                        <p class="text-gray-300 mt-1 text-lg italic">Journey to Greater Success at PSA</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="openForum()" class="text-3xl text-white hover:text-blue-400 transition cursor-pointer" title="Community Forum">
                        <i class="fas fa-comments"></i>
                    </button>
                    <button id="darkModeToggle" onclick="toggleDarkMode()" class="text-3xl text-white hover:text-blue-400 transition cursor-pointer" title="Toggle Dark Mode">
                        <i id="darkModeIcon" class="fas fa-moon"></i>
                    </button>
                    <div class="text-right">
                        <div class="text-2xl font-bold psa-accent">PSA</div>
                        <div class="text-sm text-gray-300">Future-Ready Workforce</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-6 py-8 max-w-7xl">
        <!-- Employee Selector Card -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-6 card-hover border-l-4 border-gray-800">
            <div class="flex items-center gap-3 mb-4">
                <i class="fas fa-user-circle text-3xl text-gray-800"></i>
                <h2 class="text-2xl font-bold text-gray-800">Select Employee</h2>
            </div>
            <select id="employeeSelect" class="w-full p-4 border-2 border-gray-300 rounded-xl text-lg focus:border-gray-800 focus:ring-4 focus:ring-gray-200 transition">
                <option value="">Loading employees...</option>
            </select>
        </div>

        <!-- Quick Stats Dashboard -->
        <div id="statsCard" class="hidden mb-6">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <div class="bg-white rounded-2xl shadow-lg p-6 card-hover border-t-4 border-gray-800">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 font-semibold">Years at PSA</p>
                            <p id="yearsAtPSA" class="text-3xl font-bold text-gray-800 mt-1">0</p>
                        </div>
                        <i class="fas fa-calendar-alt text-4xl text-gray-300"></i>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6 card-hover border-t-4 border-green-600">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 font-semibold">Skills Mastered</p>
                            <p id="skillCount" class="text-3xl font-bold text-green-600 mt-1">0</p>
                        </div>
                        <i class="fas fa-award text-4xl text-green-200"></i>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6 card-hover border-t-4 border-purple-600">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 font-semibold">Department</p>
                            <p id="deptName" class="text-xl font-bold text-purple-600 mt-1">-</p>
                        </div>
                        <i class="fas fa-building text-4xl text-purple-200"></i>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6 card-hover border-t-4 border-orange-600">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500 font-semibold">Projects</p>
                            <p id="projectCount" class="text-3xl font-bold text-orange-600 mt-1">0</p>
                        </div>
                        <i class="fas fa-project-diagram text-4xl text-orange-200"></i>
                    </div>
                </div>
                <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl shadow-lg p-6 card-hover border-t-4 border-blue-400">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-300 font-semibold">Leadership Potential</p>
                            <p id="leadershipScore" class="text-3xl font-bold text-blue-400 mt-1">-</p>
                        </div>
                        <i class="fas fa-crown text-4xl text-blue-300"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Skills Coverage Card -->
        <div id="skillsCoverageCard" class="bg-white rounded-2xl shadow-lg p-6 mb-6 card-hover border-l-4 border-purple-600 hidden">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                    <i class="fas fa-chart-pie text-3xl text-purple-600"></i>
                    <h2 class="text-2xl font-bold text-gray-800">PSA Skills Framework Coverage</h2>
                </div>
                <span id="coveragePercent" class="text-3xl font-bold text-purple-600">0%</span>
            </div>
            
            <div class="grid md:grid-cols-3 gap-4 mb-4">
                <div class="bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl p-4 text-center">
                    <p class="text-sm text-gray-600 mb-1">Your Skills</p>
                    <p id="yourSkillsCount" class="text-3xl font-bold text-gray-800">0</p>
                </div>
                <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-4 text-center">
                    <p class="text-sm text-gray-600 mb-1">PSA Framework</p>
                    <p id="totalSkillsCount" class="text-3xl font-bold text-purple-600">107</p>
                </div>
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 text-center">
                    <p class="text-sm text-gray-600 mb-1">Growth Opportunities</p>
                    <p id="recommendedCount" class="text-3xl font-bold text-green-600">0</p>
                </div>
            </div>
            
            <div class="bg-gray-50 rounded-xl p-4">
                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                    <i class="fas fa-lightbulb text-yellow-500"></i>
                    Recommended Skills to Develop
                </h3>
                <div id="recommendedSkillsList" class="flex flex-wrap gap-2"></div>
            </div>
        </div>

        <!-- Resume Upload Card -->
        <div id="resumeUploadCard" class="bg-white rounded-2xl shadow-lg p-6 mb-6 card-hover border-l-4 border-indigo-600 hidden">
            <div class="flex items-center gap-3 mb-4">
                <i class="fas fa-file-upload text-3xl text-indigo-600"></i>
                <h2 class="text-2xl font-bold text-gray-800">Upload Resume for AI Skills Analysis</h2>
            </div>
            
            <div id="uploadArea" class="upload-area rounded-xl p-8 text-center cursor-pointer mb-4">
                <input type="file" id="resumeFile" accept=".pdf,.doc,.docx,.txt" class="hidden" onchange="handleResumeUpload(event)">
                <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
                <p class="text-lg font-semibold text-gray-700 mb-2">Drag & Drop your resume here</p>
                <p class="text-sm text-gray-500 mb-4">or click to browse</p>
                <button onclick="document.getElementById('resumeFile').click()" 
                        class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-indigo-700 hover:to-purple-700 transition">
                    <i class="fas fa-folder-open mr-2"></i>Select File
                </button>
                <p class="text-xs text-gray-400 mt-3">Supported formats: PDF, DOC, DOCX, TXT</p>
            </div>

            <div id="resumeProcessing" class="hidden bg-blue-50 border-2 border-blue-200 rounded-xl p-6 text-center">
                <i class="fas fa-cog fa-spin text-4xl text-blue-600 mb-3"></i>
                <p class="text-lg font-semibold text-gray-800">AI is analyzing your resume...</p>
                <p class="text-sm text-gray-600 mt-2">Extracting skills, experience, and qualifications</p>
            </div>

            <div id="resumeResults" class="hidden">
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6 mb-4">
                    <div class="flex items-center gap-3 mb-3">
                        <i class="fas fa-check-circle text-3xl text-green-600"></i>
                        <h3 class="text-xl font-bold text-gray-800">Resume Analyzed Successfully!</h3>
                    </div>
                    <p class="text-gray-700 mb-4">We've extracted the following information from your resume:</p>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-white rounded-lg p-4">
                            <p class="text-sm font-semibold text-gray-600 mb-2">New Skills Detected</p>
                            <p id="newSkillsCount" class="text-3xl font-bold text-green-600">0</p>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <p class="text-sm font-semibold text-gray-600 mb-2">Total Skills</p>
                            <p id="totalSkillsAfterUpload" class="text-3xl font-bold text-purple-600">0</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white border-2 border-gray-200 rounded-xl p-6">
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-sparkles text-yellow-500"></i>
                        Skills Extracted from Resume
                    </h4>
                    <div id="extractedSkillsList" class="flex flex-wrap gap-2"></div>
                </div>
            </div>
        </div>

        <!-- Current Profile Card -->
        <div id="profileCard" class="bg-white rounded-2xl shadow-lg p-6 mb-6 card-hover border-l-4 border-gray-800 hidden">
            <div class="flex items-center gap-3 mb-4">
                <i class="fas fa-briefcase text-3xl text-gray-800"></i>
                <h2 class="text-2xl font-bold text-gray-800">Current Profile</h2>
            </div>
            
            <div id="profileContent" class="mb-6"></div>
            
            <!-- Career Goals Input -->
            <div class="bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl p-6 border-2 border-gray-200">
                <label class="flex items-center gap-2 text-lg font-bold text-gray-800 mb-3">
                    <i class="fas fa-bullseye text-gray-800"></i>
                    Career Aspiration
                </label>
                <input type="text" id="targetRole" 
                       placeholder="e.g., Chief Technology Officer, VP Operations, Head of Innovation"
                       class="w-full p-4 border-2 border-gray-300 rounded-lg text-lg focus:border-gray-800 focus:ring-4 focus:ring-gray-200 transition mb-4">
                
                <button onclick="analyzeCareer()" 
                        class="w-full bg-gradient-to-r from-gray-800 to-gray-900 text-white py-4 rounded-xl text-lg font-bold hover:from-gray-900 hover:to-black transition shadow-lg flex items-center justify-center gap-3">
                    <i class="fas fa-robot text-2xl"></i>
                    Generate AI Career Roadmap
                </button>
                
                <div class="mt-4 pt-4 border-t-2 border-gray-300">
                    <button onclick="openSkillsMatch()" 
                            class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl text-lg font-bold hover:from-purple-700 hover:to-pink-700 transition shadow-lg flex items-center justify-center gap-3">
                        <i class="fas fa-fire text-2xl"></i>
                        üîç Discover Your Next Opportunity
                    </button>
                    <p class="text-sm text-gray-500 text-center mt-2">
                        Swipe through PSA opportunities matched to your skills
                    </p>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="hidden bg-white rounded-2xl shadow-lg p-12 text-center border-l-4 border-gray-800">
            <div class="inline-block">
                <i class="fas fa-cog fa-spin text-6xl text-gray-800 mb-4"></i>
                <p class="text-2xl text-gray-800 font-bold">AI Analysis in Progress...</p>
                <p class="text-gray-500 mt-2">Analyzing career path, skill gaps, leadership potential & opportunities</p>
            </div>
        </div>

        <!-- Results Dashboard -->
        <div id="resultsCard" class="hidden space-y-6">
            <!-- Readiness Score -->
            <div class="bg-gradient-to-br from-gray-800 to-gray-900 text-white rounded-2xl shadow-2xl p-8">
                <div class="grid md:grid-cols-3 gap-8 items-center">
                    <div class="md:col-span-2">
                        <div class="flex items-center gap-3 mb-3">
                            <i class="fas fa-chart-line text-4xl"></i>
                            <h2 class="text-3xl font-bold">Career Readiness Score</h2>
                        </div>
                        <p id="readinessSummary" class="text-lg text-gray-200"></p>
                    </div>
                    <div class="flex justify-center">
                        <div class="relative w-40 h-40">
                            <svg class="w-full h-full" viewBox="0 0 100 100">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="10"/>
                                <circle id="progressCircle" cx="50" cy="50" r="45" fill="none" stroke="white" stroke-width="10" 
                                        stroke-dasharray="283" stroke-dashoffset="283" class="progress-ring" stroke-linecap="round"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span id="readinessScore" class="text-5xl font-bold"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Business Impact ROI Card -->
            <div class="bg-gradient-to-br from-blue-600 to-indigo-700 text-white rounded-2xl shadow-2xl p-8 border-2 border-blue-400">
                <div class="flex items-center gap-3 mb-6">
                    <i class="fas fa-chart-line text-4xl"></i>
                    <h2 class="text-3xl font-bold">Career Investment ROI</h2>
                </div>
                
                <div class="grid md:grid-cols-4 gap-6">
                    <!-- Cost Savings -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm">
                        <div class="flex items-center gap-3 mb-3">
                            <i class="fas fa-dollar-sign text-3xl text-green-300"></i>
                            <div>
                                <p class="text-sm text-blue-100 font-semibold">Cost Savings</p>
                                <p class="text-3xl font-bold">$12,500</p>
                            </div>
                        </div>
                        <p class="text-sm text-blue-100">vs. External Hire Cost</p>
                    </div>

                    <!-- Time to Competency -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm">
                        <div class="flex items-center gap-3 mb-3">
                            <i class="fas fa-clock text-3xl text-yellow-300"></i>
                            <div>
                                <p class="text-sm text-blue-100 font-semibold">Time to Promotion</p>
                                <p class="text-3xl font-bold">8 months</p>
                            </div>
                        </div>
                        <p class="text-sm text-blue-100">vs. Industry Avg: 18 months</p>
                    </div>

                    <!-- Retention Impact -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm">
                        <div class="flex items-center gap-3 mb-3">
                            <i class="fas fa-chart-line text-3xl text-purple-300"></i>
                            <div>
                                <p class="text-sm text-blue-100 font-semibold">Retention Boost</p>
                                <p class="text-3xl font-bold">+45%</p>
                            </div>
                        </div>
                        <p class="text-sm text-blue-100">With clear career path</p>
                    </div>

                    <!-- Skills Coverage -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm">
                        <div class="flex items-center gap-3 mb-3">
                            <i class="fas fa-trophy text-3xl text-orange-300"></i>
                            <div>
                                <p class="text-sm text-blue-100 font-semibold">Skills Coverage</p>
                                <p class="text-3xl font-bold">87%</p>
                            </div>
                        </div>
                        <p class="text-sm text-blue-100">‚Üë from 64%</p>
                    </div>
                </div>

                <div class="mt-6 bg-white bg-opacity-10 rounded-xl p-4">
                    <p class="text-sm text-blue-100 flex items-center gap-2">
                        <i class="fas fa-info-circle"></i>
                        <span>Following this personalized roadmap maximizes ROI and accelerates your career trajectory at PSA</span>
                    </p>
                </div>
            </div>

            <!-- Skill Gaps -->
            <div class="bg-white rounded-2xl shadow-lg p-8 border-l-4 border-red-600">
                <div class="flex items-center gap-3 mb-6">
                    <i class="fas fa-target text-3xl text-red-600"></i>
                    <h2 class="text-3xl font-bold text-gray-800">Priority Skills Development</h2>
                </div>
                <div id="skillGaps" class="grid md:grid-cols-3 gap-4"></div>
            </div>

            <!-- Progress & Achievements -->
            <div class="bg-gradient-to-br from-purple-600 to-pink-600 text-white rounded-2xl shadow-lg p-8 border-2 border-purple-400">
                <div class="flex items-center gap-3 mb-6">
                    <i class="fas fa-trophy text-4xl"></i>
                    <h2 class="text-3xl font-bold">Your Progress & Achievements</h2>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Progress Tracker -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-bold flex items-center gap-2">
                                <i class="fas fa-calendar-check"></i>
                                Learning Journey
                            </h3>
                            <span class="text-2xl font-bold">Week 2 of 12</span>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="bg-white bg-opacity-20 rounded-full h-4 mb-4">
                            <div class="bg-white rounded-full h-4" style="width: 17%"></div>
                        </div>
                        
                        <div class="flex items-center gap-2 text-sm">
                            <i class="fas fa-fire text-orange-300"></i>
                            <span>On track! Keep up the momentum ‚ú®</span>
                        </div>
                    </div>

                    <!-- Achievements -->
                    <div class="bg-white bg-opacity-10 rounded-xl p-6 backdrop-blur-sm">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-award"></i>
                            Achievements Unlocked
                        </h3>
                        
                        <div class="space-y-3">
                            <div class="flex items-center gap-3 bg-white bg-opacity-10 rounded-lg p-3">
                                <div class="w-10 h-10 bg-yellow-400 rounded-full flex items-center justify-center text-2xl">
                                    ‚ö°
                                </div>
                                <div class="flex-grow">
                                    <p class="font-bold text-sm">Fast Starter</p>
                                    <p class="text-xs text-purple-100">Started learning within 24 hours</p>
                                </div>
                            </div>

                            <div class="flex items-center gap-3 bg-white bg-opacity-10 rounded-lg p-3">
                                <div class="w-10 h-10 bg-orange-400 rounded-full flex items-center justify-center text-2xl">
                                    üî•
                                </div>
                                <div class="flex-grow">
                                    <p class="font-bold text-sm">5-Day Streak</p>
                                    <p class="text-xs text-purple-100">Consistent learning momentum</p>
                                </div>
                            </div>

                            <div class="flex items-center gap-3 bg-white bg-opacity-10 rounded-lg p-3">
                                <div class="w-10 h-10 bg-green-400 rounded-full flex items-center justify-center text-2xl">
                                    üìö
                                </div>
                                <div class="flex-grow">
                                    <p class="font-bold text-sm">Module Complete</p>
                                    <p class="text-xs text-purple-100">Cloud Fundamentals finished</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="mt-6 grid grid-cols-3 gap-4">
                    <div class="bg-white bg-opacity-10 rounded-xl p-4 text-center">
                        <p class="text-3xl font-bold mb-1">12</p>
                        <p class="text-sm text-purple-100">Hours Invested</p>
                    </div>
                    <div class="bg-white bg-opacity-10 rounded-xl p-4 text-center">
                        <p class="text-3xl font-bold mb-1">3/8</p>
                        <p class="text-sm text-purple-100">Skills Mastered</p>
                    </div>
                    <div class="bg-white bg-opacity-10 rounded-xl p-4 text-center">
                        <p class="text-3xl font-bold mb-1">87%</p>
                        <p class="text-sm text-purple-100">Completion Rate</p>
                    </div>
                </div>
            </div>

            <!-- Learning Roadmap -->
            <div class="bg-white rounded-2xl shadow-lg p-8 border-l-4 border-blue-600">
                <div class="flex items-center gap-3 mb-6">
                    <i class="fas fa-road text-3xl text-blue-600"></i>
                    <h2 class="text-3xl font-bold text-gray-800">Your Learning Roadmap</h2>
                </div>
                <p class="text-gray-600 mb-4"><i class="fas fa-hand-pointer text-blue-600"></i> Click on any learning step below to see the detailed weekly breakdown</p>
                <div id="learningPath" class="space-y-4"></div>
            </div>

            <!-- Two Column Layout: Opportunities + Actions -->
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Internal Opportunities -->
                <div class="bg-gradient-to-br from-purple-50 to-pink-50 border-2 border-purple-200 rounded-2xl shadow-lg p-8">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-building text-3xl text-purple-600"></i>
                        <h2 class="text-2xl font-bold text-gray-800">PSA Opportunities</h2>
                    </div>
                    <div id="opportunities" class="space-y-3"></div>
                </div>

                <!-- 30-Day Action Plan -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-2xl shadow-lg p-8">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-calendar-check text-3xl text-green-600"></i>
                        <h2 class="text-2xl font-bold text-gray-800">Start This Month</h2>
                    </div>
                    <ul id="next30Days" class="space-y-3"></ul>
                </div>
            </div>

            <!-- Mentorship Card -->
            <div class="bg-gradient-to-br from-orange-50 to-amber-50 border-2 border-orange-200 rounded-2xl shadow-lg p-8">
                <div class="flex items-center gap-3 mb-4">
                    <i class="fas fa-user-tie text-3xl text-orange-600"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Recommended Mentor</h2>
                </div>
                <p id="mentorshipMatch" class="text-lg text-gray-700"></p>
            </div>
        </div>

        <!-- Opportunity-Focused Results -->
        <div id="opportunityResultsCard" class="hidden space-y-6">
            <!-- Back Button -->
            <button onclick="backToEmployeeView()" class="flex items-center gap-2 text-gray-700 hover:text-gray-900 font-semibold mb-4 transition">
                <i class="fas fa-arrow-left text-xl"></i>
                <span>Back to Full Career Analysis</span>
            </button>

            <!-- Header -->
            <div class="bg-gradient-to-br from-purple-600 to-pink-600 text-white rounded-2xl shadow-2xl p-8">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-4xl">
                        üéØ
                    </div>
                    <div class="flex-grow">
                        <p class="text-purple-100 text-sm font-semibold mb-1">FOCUSED LEARNING PATH FOR:</p>
                        <h2 id="oppTitle" class="text-3xl font-bold"></h2>
                    </div>
                    <div class="text-right">
                        <p class="text-purple-100 text-sm mb-1">Match Score</p>
                        <p id="oppCompatibility" class="text-4xl font-bold"></p>
                    </div>
                </div>
                <div class="bg-white bg-opacity-10 rounded-xl p-4">
                    <p id="oppReadiness" class="text-lg"></p>
                    <p class="text-sm text-purple-100 mt-2">
                        <i class="fas fa-clock"></i> Time to ready: <span id="oppTimeToReady" class="font-bold"></span>
                    </p>
                </div>
            </div>

            <!-- Learning Steps -->
            <div id="oppLearningSteps" class="space-y-6"></div>

            <!-- Two Column Layout -->
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Quick Wins -->
                <div class="bg-gradient-to-br from-orange-50 to-amber-50 border-2 border-orange-200 rounded-2xl shadow-lg p-8">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-rocket text-3xl text-orange-600"></i>
                        <h2 class="text-2xl font-bold text-gray-800">Quick Wins This Week</h2>
                    </div>
                    <ul id="oppQuickWins" class="space-y-3"></ul>
                </div>

                <!-- Success Metrics -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-2xl shadow-lg p-8">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-trophy text-3xl text-green-600"></i>
                        <h2 class="text-2xl font-bold text-gray-800">Success Milestones</h2>
                    </div>
                    <div id="oppSuccessMetrics" class="space-y-3"></div>
                </div>
            </div>

            <!-- Next Step CTA -->
            <div class="bg-gradient-to-br from-blue-600 to-indigo-700 text-white rounded-2xl shadow-2xl p-8">
                <div class="flex items-center gap-4">
                    <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-4xl">
                        ‚ö°
                    </div>
                    <div class="flex-grow">
                        <h3 class="text-2xl font-bold mb-2">Your Next Step Today:</h3>
                        <p id="oppNextStep" class="text-xl"></p>
                    </div>
                </div>
            </div>

            <!-- Back to Opportunities Button -->
            <button onclick="backToSkillsMatch()" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl text-lg font-bold hover:from-purple-700 hover:to-pink-700 transition shadow-lg flex items-center justify-center gap-3">
                <i class="fas fa-fire text-2xl"></i>
                Explore More Opportunities
            </button>
        </div>

        <!-- Detailed Learning View (Hidden by default) -->
        <div id="detailedLearningView" class="hidden space-y-6">
            <!-- Back Button -->
            <button onclick="backToRoadmap()" class="flex items-center gap-2 text-gray-700 hover:text-gray-900 font-semibold mb-4 transition">
                <i class="fas fa-arrow-left text-xl"></i>
                <span>Back to Career Roadmap</span>
            </button>

            <!-- Learning Detail Header -->
            <div class="bg-gradient-to-br from-blue-600 to-indigo-700 text-white rounded-2xl shadow-2xl p-8">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <i class="fas fa-graduation-cap text-4xl"></i>
                    </div>
                    <div class="flex-grow">
                        <p class="text-blue-100 text-sm font-semibold mb-1">STEP <span id="detailStepNumber"></span> OF YOUR LEARNING JOURNEY</p>
                        <h2 id="detailSkillName" class="text-4xl font-bold"></h2>
                    </div>
                    <div class="text-right">
                        <p class="text-blue-100 text-sm mb-1">Duration</p>
                        <p id="detailTimeline" class="text-2xl font-bold"></p>
                    </div>
                </div>
                <p id="detailAction" class="text-lg text-blue-50 mt-4"></p>
            </div>

            <!-- Resources Section -->
            <div class="bg-white rounded-2xl shadow-lg p-8 border-l-4 border-green-600">
                <div class="flex items-center gap-3 mb-6">
                    <i class="fas fa-book-open text-3xl text-green-600"></i>
                    <h3 class="text-2xl font-bold text-gray-800">Recommended Learning Resources</h3>
                </div>
                <div id="detailResources" class="grid md:grid-cols-2 gap-4"></div>
            </div>

            <!-- Weekly Breakdown -->
            <div class="bg-white rounded-2xl shadow-lg p-8 border-l-4 border-purple-600">
                <div class="flex items-center gap-3 mb-6">
                    <i class="fas fa-calendar-week text-3xl text-purple-600"></i>
                    <h3 class="text-2xl font-bold text-gray-800">Week-by-Week Learning Plan</h3>
                </div>
                <div id="weeklyBreakdown" class="space-y-4"></div>
            </div>

            <!-- Success Metrics -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-2xl shadow-lg p-8">
                <div class="flex items-center gap-3 mb-6">
                    <i class="fas fa-trophy text-3xl text-green-600"></i>
                    <h3 class="text-2xl font-bold text-gray-800">Success Metrics & Milestones</h3>
                </div>
                <div id="successMetrics" class="space-y-3"></div>
            </div>

            <!-- Next Steps -->
            <div class="bg-gradient-to-br from-orange-50 to-amber-50 border-2 border-orange-200 rounded-2xl shadow-lg p-8">
                <div class="flex items-center gap-3 mb-4">
                    <i class="fas fa-rocket text-3xl text-orange-600"></i>
                    <h3 class="text-2xl font-bold text-gray-800">Getting Started</h3>
                </div>
                <div id="gettingStarted" class="space-y-3"></div>
            </div>

            <!-- Back Button (Bottom) -->
            <button onclick="backToRoadmap()" class="w-full bg-gradient-to-r from-gray-800 to-gray-900 text-white py-4 rounded-xl text-lg font-bold hover:from-gray-900 hover:to-black transition shadow-lg flex items-center justify-center gap-3">
                <i class="fas fa-arrow-left text-xl"></i>
                Back to Career Roadmap Overview
            </button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-8 mt-16">
        <div class="container mx-auto px-4 text-center">
            <div class="flex items-center justify-center gap-3 mb-2">
                <i class="fas fa-ship text-2xl psa-accent"></i>
                <p class="text-lg font-semibold">SkillsVoyage</p>
            </div>
            <p class="text-sm text-gray-400">Empowering PSA's Future-Ready Workforce</p>
            <p class="text-xs text-gray-500 mt-2">Built for PSA Code Sprint 2025 ‚Ä¢ Problem Statement 4</p>
        </div>
    </footer>

    <!-- SkillsMatch Modal -->
    <div id="skillsMatchModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-fire text-3xl"></i>
                        <h2 class="text-3xl font-bold">SkillsMatch</h2>
                    </div>
                    <button onclick="closeSkillsMatch()" class="text-white hover:text-gray-200 text-3xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <p class="text-purple-100 mt-2">Discover opportunities matched to your profile</p>
            </div>

            <!-- Card Container -->
            <div class="relative h-[500px] bg-gray-50">
                <div id="cardStack" class="absolute inset-0 flex items-center justify-center p-8">
                    <!-- Cards will be inserted here by JavaScript -->
                </div>

                <!-- No More Cards Message -->
                <div id="noMoreCards" class="hidden absolute inset-0 flex flex-col items-center justify-center p-8">
                    <i class="fas fa-check-circle text-6xl text-green-500 mb-4"></i>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">All Caught Up!</h3>
                    <p class="text-gray-600 text-center mb-6">You've reviewed all available opportunities</p>
                    <button onclick="closeSkillsMatch()" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-3 rounded-xl font-bold hover:from-purple-700 hover:to-pink-700 transition">
                        Close
                    </button>
                </div>
            </div>

            <!-- Instructions -->
            <div class="bg-gray-100 p-6 border-t-2 border-gray-200">
                <div class="flex items-center justify-center gap-8 text-sm">
                    <div class="flex items-center gap-2 text-gray-600">
                        <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white">
                            <i class="fas fa-times"></i>
                        </div>
                        <span>Drag Left: Not Interested</span>
                    </div>
                    <div class="flex items-center gap-2 text-gray-600">
                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white">
                            <i class="fas fa-check"></i>
                        </div>
                        <span>Drag Right: Interested</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- High Compatibility Popup -->
    <div id="highCompatPopup" class="hidden fixed inset-0 bg-black bg-opacity-75 z-[60] flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 text-center">
            <div class="text-6xl mb-4">üéØ</div>
            <h3 class="text-3xl font-bold text-gray-800 mb-2">Highly Compatible! üòè</h3>
            <p class="text-xl text-gray-600 mb-4">You're <span id="compatScore" class="font-bold text-purple-600">92%</span> ready for this opportunity!</p>
            
            <div class="bg-purple-50 rounded-xl p-4 mb-6 text-left">
                <p class="font-bold text-red-600 mb-2 flex items-center gap-2 text-lg">
                    ‚ÄºÔ∏è Missing Skills:
                </p>
                <ul id="missingSkills" class="space-y-1 text-sm text-gray-600">
                    <!-- Will be populated by JavaScript -->
                </ul>
                <p class="text-sm text-purple-600 font-semibold mt-3">
                    Estimated Learning Time: <span id="learningTime">4 weeks</span>
                </p>
            </div>

            <button onclick="generatePathFromMatch()" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl text-lg font-bold hover:from-purple-700 hover:to-pink-700 transition shadow-lg mb-3">
                <i class="fas fa-rocket"></i> Generate Learning Path
            </button>
            <button onclick="closeHighCompatPopup()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-300 transition">
                Continue Browsing
            </button>
        </div>
    </div>

    <!-- Community Forum Modal -->
    <div id="forumModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Forum Header -->
            <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white p-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-comments text-3xl"></i>
                        <div>
                            <h2 class="text-3xl font-bold">PSA Community Forum</h2>
                            <p class="text-gray-300 text-sm">Connect, share, and learn together anonymously</p>
                        </div>
                    </div>
                    <button onclick="closeForum()" class="text-white hover:text-gray-300 text-3xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Forum Navigation -->
            <div class="bg-gray-100 p-4 border-b-2 border-gray-300 flex items-center gap-4">
                <button onclick="showForumTab('browse')" id="browseTab" class="px-4 py-2 bg-gray-800 text-white rounded-lg font-semibold">
                    <i class="fas fa-list mr-2"></i>Browse Posts
                </button>
                <button onclick="showForumTab('create')" id="createTab" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition">
                    <i class="fas fa-plus mr-2"></i>New Post
                </button>
                <div class="flex-grow"></div>
                <select id="categoryFilter" onchange="filterByCategory()" class="px-4 py-2 border-2 border-gray-300 rounded-lg">
                    <option value="all">All Categories</option>
                    <option value="career">Career Advice</option>
                    <option value="skills">Skills Development</option>
                    <option value="mentorship">Mentorship</option>
                    <option value="projects">Project Ideas</option>
                    <option value="general">General Discussion</option>
                </select>
            </div>

            <!-- Forum Content Area -->
            <div class="flex-grow overflow-y-auto">
                <!-- Browse Posts Tab -->
                <div id="browsePosts" class="p-6 space-y-4">
                    <!-- Posts will be loaded here -->
                </div>

                <!-- Create Post Tab -->
                <div id="createPost" class="hidden p-6">
                    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-6">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <i class="fas fa-pen text-blue-600"></i>
                            Create New Anonymous Post
                        </h3>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Category</label>
                            <select id="postCategory" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition">
                                <option value="career">Career Advice</option>
                                <option value="skills">Skills Development</option>
                                <option value="mentorship">Mentorship</option>
                                <option value="projects">Project Ideas</option>
                                <option value="general">General Discussion</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Title</label>
                            <input type="text" id="postTitle" placeholder="What's your question or topic?" 
                                   class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition">
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Content</label>
                            <textarea id="postContent" rows="6" placeholder="Share your thoughts, questions, or experiences..."
                                      class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition"></textarea>
                        </div>

                        <div class="bg-yellow-50 border-2 border-yellow-300 rounded-lg p-3 mb-4">
                            <p class="text-sm text-gray-700 flex items-start gap-2">
                                <i class="fas fa-user-secret text-yellow-600 mt-1"></i>
                                <span>Your post will be anonymous. Only you can see that you wrote it.</span>
                            </p>
                        </div>

                        <button onclick="submitForumPost()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 text-white py-4 rounded-xl text-lg font-bold hover:from-blue-700 hover:to-indigo-800 transition shadow-lg">
                            <i class="fas fa-paper-plane mr-2"></i>Post Anonymously
                        </button>
                    </div>
                </div>

                <!-- View Post Detail -->
                <div id="viewPost" class="hidden p-6">
                    <!-- Post detail will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5001/api';
        let currentEmployee = null;
        let currentLearningPath = null;
        let currentCardIndex = 0;
        let opportunities = [];
        let forumPosts = [];
        let currentViewingPost = null;

        // Dark Mode Toggle Function
        function toggleDarkMode() {
            const body = document.body;
            const icon = document.getElementById('darkModeIcon');

            body.classList.toggle('dark');

            if (body.classList.contains('dark')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('darkMode', 'enabled');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('darkMode', 'disabled');
            }
        }

        // Check for saved dark mode preference on page load
        function initDarkMode() {
            const darkMode = localStorage.getItem('darkMode');
            const icon = document.getElementById('darkModeIcon');

            if (darkMode === 'enabled') {
                document.body.classList.add('dark');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
        }

        // Initialize dark mode on page load
        initDarkMode();

        async function loadEmployees() {
            try {
                const response = await fetch(`${API_URL}/employees`);
                const employees = await response.json();
                
                const select = document.getElementById('employeeSelect');
                select.innerHTML = '<option value="">Choose an employee...</option>';
                employees.forEach(emp => {
                    select.innerHTML += `<option value="${emp.id}">${emp.name} ‚Ä¢ ${emp.title}</option>`;
                });
            } catch (error) {
                console.error(error);
                document.getElementById('employeeSelect').innerHTML = '<option>Error loading. Is backend running?</option>';
            }
        }

        document.getElementById('employeeSelect').addEventListener('change', async (e) => {
            const empId = e.target.value;
            if (!empId) {
                document.getElementById('profileCard').classList.add('hidden');
                document.getElementById('statsCard').classList.add('hidden');
                document.getElementById('skillsCoverageCard').classList.add('hidden');
                document.getElementById('resumeUploadCard').classList.add('hidden');
                document.getElementById('resultsCard').classList.add('hidden');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/employee/${empId}`);
                currentEmployee = await response.json();
                
                displayProfile(currentEmployee, empId);
                document.getElementById('profileCard').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } catch (error) {
                alert('Error loading employee');
            }
        });

        function displayProfile(emp, empId) {
            // Show cards
            document.getElementById('profileCard').classList.remove('hidden');
            document.getElementById('statsCard').classList.remove('hidden');
            document.getElementById('skillsCoverageCard').classList.remove('hidden');
            document.getElementById('resumeUploadCard').classList.remove('hidden');
            document.getElementById('resultsCard').classList.add('hidden');
            
            // Stats
            const yearsAtPSA = 2025 - parseInt(emp.employment_info.hire_date.split('-')[0]);
            document.getElementById('yearsAtPSA').textContent = yearsAtPSA;
            document.getElementById('skillCount').textContent = emp.skills.length;
            document.getElementById('deptName').textContent = emp.employment_info.department.split(':')[0];
            document.getElementById('projectCount').textContent = emp.projects?.length || 0;
            
            // Calculate Leadership Potential Score (based on competencies + experience)
            const advancedComps = emp.competencies.filter(c => c.level === 'Advanced').length;
            const leadershipPotential = Math.min(95, 60 + (advancedComps * 10) + (yearsAtPSA * 2));
            document.getElementById('leadershipScore').textContent = leadershipPotential + '%';
            
            // Profile
            const initials = emp.personal_info.name.split(' ').map(n => n[0]).join('');
            document.getElementById('profileContent').innerHTML = `
                <div class="flex items-center gap-6">
                    <div class="w-20 h-20 bg-gradient-to-br from-gray-800 to-gray-900 rounded-full flex items-center justify-center text-white text-3xl font-bold">
                        ${initials}
                    </div>
                    <div class="flex-grow">
                        <h3 class="text-2xl font-bold text-gray-800">${emp.personal_info.name}</h3>
                        <p class="text-lg text-gray-600">${emp.employment_info.job_title}</p>
                        <div class="flex gap-3 mt-2">
                            ${emp.competencies.slice(0, 3).map(c => 
                                `<span class="px-3 py-1 ${c.level === 'Advanced' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'} rounded-full text-sm font-semibold">${c.name}</span>`
                            ).join('')}
                        </div>
                    </div>
                </div>
            `;

            // Reset resume upload area
            document.getElementById('resumeResults').classList.add('hidden');
            document.getElementById('uploadArea').classList.remove('hidden');

            // Fetch skills matching
            fetch(`${API_URL}/match-skills/${empId}`)
                .then(r => r.json())
                .then(data => {
                    document.getElementById('coveragePercent').textContent = data.coverage_percentage + '%';
                    document.getElementById('yourSkillsCount').textContent = data.current_skills_count;
                    document.getElementById('totalSkillsCount').textContent = data.total_psa_skills;
                    document.getElementById('recommendedCount').textContent = data.recommended_skills.length;
                    
                    document.getElementById('recommendedSkillsList').innerHTML = 
                        data.recommended_skills.slice(0, 8).map(skill => 
                            `<span class="px-3 py-2 bg-white border-2 border-purple-200 rounded-lg text-sm font-semibold text-gray-700 hover:bg-purple-50 transition skill-badge">
                                ${skill.skill}
                            </span>`
                        ).join('');
                })
                .catch(err => console.error('Skills matching error:', err));
        }

        // Resume Upload Functionality
        const uploadArea = document.getElementById('uploadArea');

        // Drag and drop handlers
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) {
                processResumeFile(file);
            }
        });

        async function handleResumeUpload(event) {
            const file = event.target.files[0];
            if (file) {
                processResumeFile(file);
            }
        }

        async function processResumeFile(file) {
            if (!currentEmployee) {
                alert('Please select an employee first');
                return;
            }

            // Show processing state
            document.getElementById('uploadArea').classList.add('hidden');
            document.getElementById('resumeProcessing').classList.remove('hidden');

            // Create FormData
            const formData = new FormData();
            formData.append('resume', file);
            formData.append('employee_id', currentEmployee.employee_id);

            try {
                const response = await fetch(`${API_URL}/upload-resume`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Resume upload failed');
                }

                const result = await response.json();
                displayResumeResults(result);
            } catch (error) {
                alert('Error processing resume: ' + error.message);
                console.error(error);
                // Reset upload area
                document.getElementById('resumeProcessing').classList.add('hidden');
                document.getElementById('uploadArea').classList.remove('hidden');
            }
        }

        function displayResumeResults(data) {
            // Hide processing
            document.getElementById('resumeProcessing').classList.add('hidden');
            
            // Show results
            document.getElementById('resumeResults').classList.remove('hidden');
            
            // Update counts
            document.getElementById('newSkillsCount').textContent = data.new_skills_added;
            document.getElementById('totalSkillsAfterUpload').textContent = data.total_skills;
            
            // Display extracted skills
            document.getElementById('extractedSkillsList').innerHTML = 
                data.extracted_skills.map(skill => 
                    `<span class="px-3 py-2 ${skill.is_new ? 'bg-green-100 text-green-700 border-2 border-green-300' : 'bg-gray-100 text-gray-600 border-2 border-gray-300'} rounded-lg text-sm font-semibold skill-badge">
                        ${skill.is_new ? '‚ú® ' : ''}${skill.skill}${skill.is_new ? ' (New!)' : ''}
                    </span>`
                ).join('');

            // Update the skill count in stats
            document.getElementById('skillCount').textContent = data.total_skills;

            // Refresh the employee data
            fetch(`${API_URL}/employee/${currentEmployee.employee_id}`)
                .then(r => r.json())
                .then(updatedEmp => {
                    currentEmployee = updatedEmp;
                });

            // Show success message
            setTimeout(() => {
                document.getElementById('resumeResults').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // Forum Functionality
        function openForum() {
            document.getElementById('forumModal').classList.remove('hidden');
            loadForumPosts();
        }

        function closeForum() {
            document.getElementById('forumModal').classList.add('hidden');
        }

        function showForumTab(tab) {
            const browsePosts = document.getElementById('browsePosts');
            const createPost = document.getElementById('createPost');
            const viewPost = document.getElementById('viewPost');
            const browseTab = document.getElementById('browseTab');
            const createTab = document.getElementById('createTab');

            if (tab === 'browse') {
                browsePosts.classList.remove('hidden');
                createPost.classList.add('hidden');
                viewPost.classList.add('hidden');
                browseTab.classList.remove('bg-gray-200', 'text-gray-700');
                browseTab.classList.add('bg-gray-800', 'text-white');
                createTab.classList.remove('bg-gray-800', 'text-white');
                createTab.classList.add('bg-gray-200', 'text-gray-700');
            } else if (tab === 'create') {
                browsePosts.classList.add('hidden');
                createPost.classList.remove('hidden');
                viewPost.classList.add('hidden');
                createTab.classList.remove('bg-gray-200', 'text-gray-700');
                createTab.classList.add('bg-gray-800', 'text-white');
                browseTab.classList.remove('bg-gray-800', 'text-white');
                browseTab.classList.add('bg-gray-200', 'text-gray-700');
            }
        }

        async function loadForumPosts() {
            try {
                const response = await fetch(`${API_URL}/forum/posts`);
                forumPosts = await response.json();
                displayForumPosts(forumPosts);
            } catch (error) {
                console.error('Error loading forum posts:', error);
                // Show sample posts if backend not ready
                forumPosts = getSampleForumPosts();
                displayForumPosts(forumPosts);
            }
        }

        function getSampleForumPosts() {
            return [
                {
                    id: 1,
                    category: 'career',
                    title: 'How to transition from IT to Data Science?',
                    content: 'I have 5 years in IT support and want to move into data science. What skills should I focus on?',
                    author: 'Anonymous Crane',
                    timestamp: '2 hours ago',
                    replies: 3,
                    likes: 8
                },
                {
                    id: 2,
                    category: 'mentorship',
                    title: 'Looking for a mentor in port operations',
                    content: 'I\'m new to PSA and would love guidance on how to excel in terminal operations.',
                    author: 'Anonymous Seagull',
                    timestamp: '5 hours ago',
                    replies: 1,
                    likes: 5
                },
                {
                    id: 3,
                    category: 'skills',
                    title: 'Best cloud certifications for PSA engineers?',
                    content: 'Which cloud certification would be most valuable for our infrastructure work - AWS, Azure, or GCP?',
                    author: 'Anonymous Dolphin',
                    timestamp: '1 day ago',
                    replies: 7,
                    likes: 15
                }
            ];
        }

        function displayForumPosts(posts) {
            const container = document.getElementById('browsePosts');
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-inbox text-6xl text-gray-300 mb-4"></i>
                        <p class="text-xl text-gray-600">No posts yet. Be the first to start a conversation!</p>
                    </div>
                `;
                return;
            }

            const categoryIcons = {
                'career': 'fa-briefcase',
                'skills': 'fa-graduation-cap',
                'mentorship': 'fa-user-tie',
                'projects': 'fa-project-diagram',
                'general': 'fa-comments'
            };

            const categoryColors = {
                'career': 'purple',
                'skills': 'blue',
                'mentorship': 'orange',
                'projects': 'green',
                'general': 'gray'
            };

            container.innerHTML = posts.map(post => {
                const color = categoryColors[post.category] || 'gray';
                const icon = categoryIcons[post.category] || 'fa-comment';
                
                return `
                    <div class="bg-white border-2 border-gray-200 rounded-xl p-6 forum-post cursor-pointer" onclick="viewForumPost(${post.id})">
                        <div class="flex items-start gap-4">
                            <div class="w-12 h-12 bg-${color}-100 rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="fas ${icon} text-${color}-600 text-xl"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="bg-${color}-100 text-${color}-700 px-3 py-1 rounded-full text-xs font-semibold uppercase">
                                        ${post.category}
                                    </span>
                                    <span class="text-sm text-gray-500">${post.timestamp}</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">${post.title}</h3>
                                <p class="text-gray-600 mb-3">${post.content.substring(0, 150)}${post.content.length > 150 ? '...' : ''}</p>
                                <div class="flex items-center gap-4 text-sm text-gray-500">
                                    <span class="flex items-center gap-1">
                                        <i class="fas fa-user-secret"></i>
                                        ${post.author}
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <i class="fas fa-reply"></i>
                                        ${post.replies} replies
                                    </span>
                                    <span class="flex items-center gap-1">
                                        <i class="fas fa-heart"></i>
                                        ${post.likes} likes
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function submitForumPost() {
            const category = document.getElementById('postCategory').value;
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();

            if (!title || !content) {
                alert('Please fill in both title and content');
                return;
            }

            const postData = {
                category,
                title,
                content,
                author: 'Anonymous ' + ['Crane', 'Seagull', 'Dolphin', 'Whale', 'Shark', 'Turtle'][Math.floor(Math.random() * 6)]
            };

            try {
                const response = await fetch(`${API_URL}/forum/posts`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(postData)
                });

                if (response.ok) {
                    // Clear form
                    document.getElementById('postTitle').value = '';
                    document.getElementById('postContent').value = '';
                    
                    // Reload posts and switch to browse
                    await loadForumPosts();
                    showForumTab('browse');
                    
                    alert('Post created successfully! üéâ');
                } else {
                    throw new Error('Failed to create post');
                }
            } catch (error) {
                console.error('Error creating post:', error);
                // For demo purposes, add to local array
                const newPost = {
                    ...postData,
                    id: forumPosts.length + 1,
                    timestamp: 'Just now',
                    replies: 0,
                    likes: 0
                };
                forumPosts.unshift(newPost);
                
                document.getElementById('postTitle').value = '';
                document.getElementById('postContent').value = '';
                displayForumPosts(forumPosts);
                showForumTab('browse');
                alert('Post created successfully! üéâ');
            }
        }

        function viewForumPost(postId) {
            const post = forumPosts.find(p => p.id === postId);
            if (!post) return;

            currentViewingPost = post;

            const categoryColors = {
                'career': 'purple',
                'skills': 'blue',
                'mentorship': 'orange',
                'projects': 'green',
                'general': 'gray'
            };

            const color = categoryColors[post.category] || 'gray';

            const viewPostContainer = document.getElementById('viewPost');
            viewPostContainer.innerHTML = `
                <button onclick="showForumTab('browse')" class="flex items-center gap-2 text-gray-700 hover:text-gray-900 font-semibold mb-4 transition">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Posts</span>
                </button>

                <div class="bg-white border-2 border-gray-200 rounded-xl p-6 mb-4">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="bg-${color}-100 text-${color}-700 px-3 py-1 rounded-full text-xs font-semibold uppercase">
                            ${post.category}
                        </span>
                        <span class="text-sm text-gray-500">${post.timestamp}</span>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-3">${post.title}</h2>
                    <p class="text-gray-700 mb-4">${post.content}</p>
                    <div class="flex items-center gap-4 text-sm text-gray-500 pt-4 border-t-2 border-gray-200">
                        <span class="flex items-center gap-1">
                            <i class="fas fa-user-secret"></i>
                            ${post.author}
                        </span>
                        <button onclick="likePost(${post.id})" class="flex items-center gap-1 hover:text-red-600 transition">
                            <i class="fas fa-heart"></i>
                            <span id="likeCount-${post.id}">${post.likes}</span> likes
                        </button>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-6 mb-4">
                    <h3 class="text-xl font-bold text-gray-800 mb-3">Add a Reply</h3>
                    <textarea id="replyContent" rows="4" placeholder="Share your thoughts or advice..."
                              class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition mb-3"></textarea>
                    <button onclick="submitReply(${post.id})" class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white px-6 py-3 rounded-lg font-bold hover:from-blue-700 hover:to-indigo-800 transition">
                        <i class="fas fa-reply mr-2"></i>Post Reply
                    </button>
                </div>

                <div id="repliesList" class="space-y-4">
                    ${post.replies > 0 ? generateSampleReplies(post.replies) : '<p class="text-gray-500 text-center py-8">No replies yet. Be the first to respond!</p>'}
                </div>
            `;

            document.getElementById('browsePosts').classList.add('hidden');
            document.getElementById('createPost').classList.add('hidden');
            viewPostContainer.classList.remove('hidden');
        }

        function generateSampleReplies(count) {
            const sampleReplies = [
                {
                    author: 'Anonymous Whale',
                    time: '1 hour ago',
                    content: 'Great question! I made a similar transition last year. I\'d recommend starting with Python and SQL fundamentals.'
                },
                {
                    author: 'Anonymous Shark',
                    time: '30 minutes ago',
                    content: 'Check out the PSA learning portal. They have some excellent courses on data analytics that might help.'
                },
                {
                    author: 'Anonymous Turtle',
                    time: '15 minutes ago',
                    content: 'Happy to connect offline if you want to discuss further. Feel free to reach out!'
                }
            ];

            return sampleReplies.slice(0, count).map(reply => `
                <div class="bg-white border-l-4 border-blue-500 rounded-lg p-4 reply-indent">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fas fa-user-secret text-blue-600"></i>
                        <span class="font-semibold text-gray-800">${reply.author}</span>
                        <span class="text-sm text-gray-500">${reply.time}</span>
                    </div>
                    <p class="text-gray-700">${reply.content}</p>
                </div>
            `).join('');
        }

        function submitReply(postId) {
            const content = document.getElementById('replyContent').value.trim();
            if (!content) {
                alert('Please enter a reply');
                return;
            }

            // In production, this would call the API
            const post = forumPosts.find(p => p.id === postId);
            if (post) {
                post.replies++;
            }

            alert('Reply posted successfully! üí¨');
            document.getElementById('replyContent').value = '';
            viewForumPost(postId); // Refresh view
        }

        function likePost(postId) {
            const post = forumPosts.find(p => p.id === postId);
            if (post) {
                post.likes++;
                document.getElementById(`likeCount-${postId}`).textContent = post.likes;
            }
        }

        function filterByCategory() {
            const category = document.getElementById('categoryFilter').value;
            if (category === 'all') {
                displayForumPosts(forumPosts);
            } else {
                const filtered = forumPosts.filter(p => p.category === category);
                displayForumPosts(filtered);
            }
        }

        async function analyzeCareer() {
            if (!currentEmployee) return;

            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('resultsCard').classList.add('hidden');
            document.getElementById('loading').scrollIntoView({ behavior: 'smooth' });

            try {
                const response = await fetch(`${API_URL}/analyze`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        employee_id: currentEmployee.employee_id,
                        target_role: document.getElementById('targetRole').value
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Analysis failed');
                }

                const result = await response.json();
                displayResults(result);
            } catch (error) {
                alert('Error: ' + error.message + '\n\nPlease check:\n1. Backend is running\n2. API key is configured\n3. Try again in a moment');
                console.error(error);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        function displayResults(data) {
            document.getElementById('resultsCard').classList.remove('hidden');
            currentLearningPath = data.learning_path;

            // Animated score
            const score = data.readiness_score;
            const scoreEl = document.getElementById('readinessScore');
            const circleEl = document.getElementById('progressCircle');

            scoreEl.textContent = score + '%';
            const offset = 283 - (283 * score / 100);
            circleEl.style.strokeDashoffset = offset;

            document.getElementById('readinessSummary').textContent = data.summary;

            // Skill Gaps
            document.getElementById('skillGaps').innerHTML = data.skill_gaps.map(gap => {
                const colors = {
                    'High': 'from-red-500 to-pink-500',
                    'Medium': 'from-yellow-500 to-orange-500',
                    'Low': 'from-green-500 to-emerald-500'
                };
                return `
                    <div class="bg-gradient-to-br ${colors[gap.priority]} text-white rounded-xl p-6 card-hover">
                        <div class="flex items-center justify-between mb-3">
                            <i class="fas fa-bolt text-3xl"></i>
                            <span class="text-sm font-bold opacity-90">${gap.priority}</span>
                        </div>
                        <h4 class="text-xl font-bold mb-2">${gap.skill}</h4>
                        <p class="text-sm opacity-90">${gap.why}</p>
                    </div>
                `;
            }).join('');

            // Learning Path - Make clickable
            document.getElementById('learningPath').innerHTML = data.learning_path.map((step, i) => `
                <div class="flex gap-4 cursor-pointer card-hover" onclick="showLearningDetail(${i})">
                    <div class="flex flex-col items-center">
                        <div class="w-12 h-12 bg-gray-800 text-white rounded-full flex items-center justify-center font-bold text-lg">
                            ${step.step}
                        </div>
                        ${i < data.learning_path.length - 1 ? '<div class="w-1 flex-grow bg-gray-300 my-2"></div>' : ''}
                    </div>
                    <div class="flex-grow bg-gray-50 rounded-xl p-6 mb-4 hover:bg-blue-50 transition">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="text-xl font-bold text-gray-800">${step.skill}</h4>
                            <span class="bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-sm font-semibold">${step.timeline}</span>
                        </div>
                        <p class="text-gray-700 mb-3">${step.action}</p>
                        <div class="flex flex-wrap gap-2 mb-3">
                            ${step.resources.map(r => `<span class="bg-white border border-gray-300 px-3 py-1 rounded-lg text-sm"><i class="fas fa-book text-gray-800"></i> ${r}</span>`).join('')}
                        </div>
                        <div class="flex items-center gap-2 text-blue-600 font-semibold text-sm">
                            <i class="fas fa-arrow-right"></i>
                            <span>Click to see detailed weekly breakdown</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Opportunities
            document.getElementById('opportunities').innerHTML = data.internal_opportunities.map(opp => 
                `<div class="bg-white border-l-4 border-purple-500 p-4 rounded-lg shadow">
                    <i class="fas fa-arrow-right text-purple-600"></i> ${opp}
                </div>`
            ).join('');
            
            // Next 30 Days
            document.getElementById('next30Days').innerHTML = data.next_30_days.map((item, i) => 
                `<li class="flex items-start gap-3 bg-white p-4 rounded-lg shadow">
                    <i class="fas fa-check-circle text-green-600 text-xl mt-1"></i>
                    <span class="text-gray-700">${item}</span>
                </li>`
            ).join('');
            
            // Mentorship
            document.getElementById('mentorshipMatch').textContent = data.mentorship_match;

            setTimeout(() => {
                document.getElementById('resultsCard').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        async function showLearningDetail(stepIndex) {
            const step = currentLearningPath[stepIndex];

            // Populate detail view with basic info
            document.getElementById('detailStepNumber').textContent = step.step;
            document.getElementById('detailSkillName').textContent = step.skill;
            document.getElementById('detailTimeline').textContent = step.timeline;
            document.getElementById('detailAction').textContent = step.action;

            // Resources
            document.getElementById('detailResources').innerHTML = step.resources.map((resource, i) => `
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-4">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center font-bold">
                            ${i + 1}
                        </div>
                        <h4 class="font-bold text-gray-800">${resource}</h4>
                    </div>
                    <p class="text-sm text-gray-600 ml-13">Access this resource to build your skills in ${step.skill}</p>
                </div>
            `).join('');

            // Call backend to get detailed weekly breakdown
            try {
                const response = await fetch(`${API_URL}/learning-detail`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        skill: step.skill,
                        timeline: step.timeline,
                        action: step.action,
                        resources: step.resources
                    })
                });

                if (response.ok) {
                    const detailData = await response.json();
                    displayWeeklyBreakdown(detailData.weekly_plan);
                    displaySuccessMetrics(detailData.success_metrics);
                    displayGettingStarted(detailData.getting_started);
                } else {
                    // Fallback to generated content if backend doesn't have the endpoint yet
                    generateFallbackDetails(step);
                }
            } catch (error) {
                console.error('Error fetching detail:', error);
                generateFallbackDetails(step);
            }

            // Hide roadmap, show detail view
            document.getElementById('resultsCard').classList.add('hidden');
            document.getElementById('detailedLearningView').classList.remove('hidden');
            document.getElementById('detailedLearningView').scrollIntoView({ behavior: 'smooth' });
        }

        function generateFallbackDetails(step) {
            // Parse timeline to get weeks
            const timelineMatch = step.timeline.match(/(\d+)\s*(month|week)/i);
            let weeks = 4;
            if (timelineMatch) {
                const num = parseInt(timelineMatch[1]);
                const unit = timelineMatch[2].toLowerCase();
                weeks = unit === 'month' ? num * 4 : num;
            }

            // Generate weekly breakdown
            const weeklyPlan = [];
for (let i = 1; i <= weeks; i++) {
                weeklyPlan.push({
                    week: i,
                    focus: `Week ${i} - ${step.skill} foundations and practical application`,
                    activities: [
                        `Study core concepts and principles`,
                        `Complete hands-on exercises`,
                        `Review and reflect on learning`
                    ],
                    deliverable: `Week ${i} checkpoint completed`
                });
            }

            displayWeeklyBreakdown(weeklyPlan);

            // Generate success metrics
            const successMetrics = [
                'Complete all assigned learning resources',
                'Achieve 80% or higher on knowledge assessments',
                'Apply learned skills to a PSA project',
                'Receive positive feedback from mentor or manager'
            ];
            displaySuccessMetrics(successMetrics);

            // Generate getting started
            const gettingStarted = [
                'Enroll in the recommended courses within the first week',
                'Set up a dedicated study schedule (2-3 hours per week)',
                'Connect with a mentor or peer who has this skill',
                'Identify a PSA project where you can apply this learning'
            ];
            displayGettingStarted(gettingStarted);
        }

        function displayWeeklyBreakdown(weeklyPlan) {
            document.getElementById('weeklyBreakdown').innerHTML = weeklyPlan.map(week => `
                <div class="border-l-4 border-purple-500 bg-purple-50 rounded-lg p-6 week-card">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-12 h-12 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold">
                            ${week.week}
                        </div>
                        <h4 class="text-xl font-bold text-black">${week.focus}</h4>
                    </div>
                    <div class="ml-15">
                        <p class="text-sm font-semibold text-black mb-2">Key Activities:</p>
                        <ul class="space-y-1 mb-3">
                            ${week.activities.map(activity => `
                                <li class="text-black flex items-start gap-2">
                                    <i class="fas fa-check-circle text-purple-600 mt-1"></i>
                                    <span>${activity}</span>
                                </li>
                            `).join('')}
                        </ul>
                        <div class="bg-white border border-purple-200 rounded-lg p-3 mt-3">
                            <p class="text-sm font-semibold text-purple-700">
                                <i class="fas fa-flag-checkered"></i> Deliverable: ${week.deliverable}
                            </p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function displaySuccessMetrics(metrics) {
            document.getElementById('successMetrics').innerHTML = metrics.map((metric, i) => `
                <div class="flex items-start gap-3 bg-white border-l-4 border-green-500 p-4 rounded-lg shadow">
                    <div class="w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center font-bold text-sm flex-shrink-0">
                        ${i + 1}
                    </div>
                    <p class="text-gray-700">${metric}</p>
                </div>
            `).join('');
        }

        function displayGettingStarted(steps) {
            document.getElementById('gettingStarted').innerHTML = steps.map((step, i) => `
                <div class="flex items-start gap-3 bg-white border-l-4 border-orange-500 p-4 rounded-lg shadow">
                    <i class="fas fa-star text-orange-600 text-xl mt-1"></i>
                    <p class="text-gray-700">${step}</p>
                </div>
            `).join('');
        }

        function backToRoadmap() {
            document.getElementById('detailedLearningView').classList.add('hidden');
            document.getElementById('resultsCard').classList.remove('hidden');
            document.getElementById('resultsCard').scrollIntoView({ behavior: 'smooth' });
        }

        // SkillsMatch Data
        opportunities = [
            {
                id: 1,
                title: "Tuas Port Automation - NextGen Terminal",
                compatibility: 92,
                duration: "6 months",
                team: "12 people",
                impact: "High",
                skills: [
                    { name: "Cloud Architecture", has: true },
                    { name: "IoT Systems", has: true },
                    { name: "Edge Computing", has: false }
                ],
                description: "Lead the development of automated terminal systems for Tuas Port Phase 2. Work with cutting-edge IoT and cloud technologies."
            },
            {
                id: 2,
                title: "PORTNET 2.0 Modernization Initiative",
                compatibility: 68,
                duration: "4 months",
                team: "8 people",
                impact: "Medium",
                skills: [
                    { name: "API Design", has: true },
                    { name: "Microservices", has: false },
                    { name: "DevOps", has: false }
                ],
                description: "Modernize PSA's port community system with microservices architecture and API-first design."
            },
            {
                id: 3,
                title: "Cybersecurity Infrastructure Uplift",
                compatibility: 45,
                duration: "3 months",
                team: "6 people",
                impact: "High",
                skills: [
                    { name: "Network Security", has: false },
                    { name: "Threat Analysis", has: false },
                    { name: "Risk Management", has: false }
                ],
                description: "Strengthen PSA's cybersecurity posture across all global terminals with zero-trust architecture."
            }
        ];

        // Open SkillsMatch Modal
        function openSkillsMatch() {
            if (!currentEmployee) {
                alert('Please select an employee first');
                return;
            }
            
            currentCardIndex = 0;
            document.getElementById('skillsMatchModal').classList.remove('hidden');
            renderCard();
        }

        // Close SkillsMatch Modal
        function closeSkillsMatch() {
            document.getElementById('skillsMatchModal').classList.add('hidden');
            document.getElementById('noMoreCards').classList.add('hidden');
        }

        // Render Current Card
        function renderCard() {
            const cardStack = document.getElementById('cardStack');
            
            if (currentCardIndex >= opportunities.length) {
                cardStack.innerHTML = '';
                document.getElementById('noMoreCards').classList.remove('hidden');
                return;
            }

            const opp = opportunities[currentCardIndex];
            
            const compatColor = opp.compatibility >= 90 ? 'text-green-600' : opp.compatibility >= 70 ? 'text-yellow-600' : 'text-orange-600';
            
            cardStack.innerHTML = `
                <div id="currentCard" class="w-full max-w-md bg-white rounded-2xl shadow-2xl p-6 cursor-grab active:cursor-grabbing transition-transform">
                    <!-- Compatibility Badge -->
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-4xl font-bold ${compatColor}">${opp.compatibility}%</span>
                        <div class="text-right">
                            <span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm font-semibold">
                                ${opp.duration}
                            </span>
                        </div>
                    </div>

                    <!-- Title -->
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">${opp.title}</h3>
                    
                    <!-- Description -->
                    <p class="text-gray-600 mb-4">${opp.description}</p>

                    <!-- Skills -->
                    <div class="mb-4">
                        <p class="font-semibold text-gray-800 mb-2">Skills Required:</p>
                        <div class="flex flex-wrap gap-2">
                            ${opp.skills.map(skill => `
                                <span class="px-3 py-1 rounded-full text-sm font-semibold ${skill.has ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'}">
                                    ${skill.has ? '‚úì' : '‚ö†'} ${skill.name}
                                </span>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Details -->
                    <div class="flex items-center gap-4 text-sm text-gray-600">
                        <span><i class="fas fa-users"></i> ${opp.team}</span>
                        <span><i class="fas fa-chart-line"></i> ${opp.impact} Impact</span>
                    </div>

                    <!-- Swipe Instruction -->
                    <div class="mt-6 pt-4 border-t-2 border-gray-200 text-center text-sm text-gray-500">
                        üëà Drag left to pass ‚Ä¢ Drag right if interested üëâ
                    </div>
                </div>
            `;

            setupCardDrag();
        }

        // Setup Card Dragging
        function setupCardDrag() {
            const card = document.getElementById('currentCard');
            let startX = 0;
            let currentX = 0;
            let isDragging = false;

            card.addEventListener('mousedown', dragStart);
            card.addEventListener('touchstart', dragStart);

            function dragStart(e) {
                isDragging = true;
                startX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
                card.style.transition = 'none';

                document.addEventListener('mousemove', drag);
                document.addEventListener('touchmove', drag);
                document.addEventListener('mouseup', dragEnd);
                document.addEventListener('touchend', dragEnd);
            }

            function drag(e) {
                if (!isDragging) return;
                
                currentX = (e.type === 'mousemove' ? e.clientX : e.touches[0].clientX) - startX;
                const rotation = currentX / 20;
                
                card.style.transform = `translateX(${currentX}px) rotate(${rotation}deg)`;
                
                // Visual feedback
                if (currentX > 50) {
                    card.style.borderColor = '#10b981'; // Green
                } else if (currentX < -50) {
                    card.style.borderColor = '#ef4444'; // Red
                } else {
                    card.style.borderColor = 'transparent';
                }
            }

            function dragEnd() {
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('touchmove', drag);
                document.removeEventListener('mouseup', dragEnd);
                document.removeEventListener('touchend', dragEnd);

                if (Math.abs(currentX) > 100) {
                    // Swiped far enough
                    const direction = currentX > 0 ? 'right' : 'left';
                    card.style.transition = 'transform 0.3s ease';
                    card.style.transform = `translateX(${currentX > 0 ? 1000 : -1000}px) rotate(${currentX > 0 ? 45 : -45}deg)`;
                    
                    setTimeout(() => {
                        handleSwipe(direction);
                    }, 300);
                } else {
                    // Return to center
                    card.style.transition = 'transform 0.3s ease';
                    card.style.transform = 'translateX(0) rotate(0)';
                    card.style.borderColor = 'transparent';
                }
            }
        }

        // Handle Swipe
        function handleSwipe(direction) {
            const opp = opportunities[currentCardIndex];
            
            if (direction === 'right' && opp.compatibility >= 90) {
                // Show high compatibility popup
                showHighCompatPopup(opp);
            } else {
                // Move to next card
                currentCardIndex++;
                renderCard();
            }
        }

        // Show High Compatibility Popup
        function showHighCompatPopup(opp) {
            document.getElementById('compatScore').textContent = opp.compatibility + '%';
            
            const missingSkills = opp.skills.filter(s => !s.has);
            document.getElementById('missingSkills').innerHTML = missingSkills.map(skill => 
                `<li class="flex items-center gap-2"><i class="fas fa-arrow-right text-purple-600"></i> ${skill.name}</li>`
            ).join('');
            
            document.getElementById('learningTime').textContent = '4 weeks';
            document.getElementById('highCompatPopup').classList.remove('hidden');
        }

        // Close High Compat Popup
        function closeHighCompatPopup() {
            document.getElementById('highCompatPopup').classList.add('hidden');
            currentCardIndex++;
            renderCard();
        }

        // Generate Learning Path from Match
        async function generatePathFromMatch() {
            const opp = opportunities[currentCardIndex];
            const missingSkills = opp.skills.filter(s => !s.has).map(s => s.name);
            
            // Close popups
            document.getElementById('highCompatPopup').classList.add('hidden');
            document.getElementById('skillsMatchModal').classList.add('hidden');
            
            // Show loading
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('loading').scrollIntoView({ behavior: 'smooth' });
            
            try {
                const response = await fetch(`${API_URL}/analyze-opportunity`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        employee_id: currentEmployee.employee_id,
                        opportunity_title: opp.title,
                        missing_skills: missingSkills
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Analysis failed');
                }

                const result = await response.json();
                displayOpportunityResults(result, opp);
            } catch (error) {
                alert('Error: ' + error.message);
                console.error(error);
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        // Display Opportunity-Focused Results
        function displayOpportunityResults(data, opp) {
            // Hide regular results, show opportunity results
            document.getElementById('resultsCard').classList.add('hidden');
            document.getElementById('opportunityResultsCard').classList.remove('hidden');
            
            // Set opportunity title
            document.getElementById('oppTitle').textContent = data.opportunity_title;
            document.getElementById('oppCompatibility').textContent = opp.compatibility + '%';
            document.getElementById('oppReadiness').textContent = data.readiness_assessment;
            document.getElementById('oppTimeToReady').textContent = data.time_to_ready;
            
            // Display learning steps
            document.getElementById('oppLearningSteps').innerHTML = data.learning_steps.map((step, i) => `
                <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-600">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-2xl font-bold text-gray-800">${step.skill}</h4>
                        <span class="bg-purple-100 text-purple-700 px-4 py-2 rounded-full font-semibold">${step.timeline}</span>
                    </div>
                    
                    <!-- Week by Week -->
                    <div class="space-y-3 mb-4">
                        <p class="font-semibold text-gray-700">üìÖ Week-by-Week Plan:</p>
                        ${step.week_by_week.map(week => `
                            <div class="bg-gradient-to-br from-purple-100 to-pink-100 rounded-lg p-5 border-l-4 border-purple-600 shadow-md hover:shadow-lg transition">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-purple-600 to-pink-600 text-white rounded-full flex items-center justify-center font-bold shadow-md">
                                        ${week.week}
                                    </div>
                                    <h5 class="font-bold text-gray-900 text-lg">${week.focus}</h5>
                                </div>
                                <ul class="space-y-2 ml-13 mb-3">
                                    ${week.activities.map(activity => `
                                        <li class="flex items-start gap-2 text-gray-900">
                                            <i class="fas fa-check-circle text-purple-600 mt-1 flex-shrink-0"></i>
                                            <span class="font-medium">${activity}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                                <div class="ml-13 bg-purple-50 rounded-lg p-3 border-2 border-purple-300">
                                    <p class="text-sm font-semibold text-purple-700 flex items-center gap-2">
                                        <i class="fas fa-flag-checkered"></i> 
                                        ${week.deliverable}
                                    </p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <!-- Resources -->
                    <div class="bg-green-50 rounded-lg p-4 border-l-4 border-green-500">
                        <p class="font-semibold text-black mb-2">üìö Learning Resources:</p>
                        <div class="flex flex-wrap gap-2">
                            ${step.resources.map(resource => `
                                <span class="bg-white border-2 border-green-300 px-3 py-2 rounded-lg text-sm font-semibold text-gray-800">
                                    <i class="fas fa-book text-green-600"></i> ${resource}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Quick Wins
            document.getElementById('oppQuickWins').innerHTML = data.quick_wins.map((win, i) => `
                <li class="flex items-start gap-3 bg-white p-4 rounded-lg shadow">
                    <div class="w-8 h-8 bg-orange-600 text-white rounded-full flex items-center justify-center font-bold flex-shrink-0">
                        ${i + 1}
                    </div>
                    <span class="text-gray-700">${win}</span>
                </li>
            `).join('');
            
            // Success Metrics
            document.getElementById('oppSuccessMetrics').innerHTML = data.success_metrics.map((metric, i) => `
                <div class="flex items-start gap-3 bg-white border-l-4 border-green-500 p-4 rounded-lg shadow">
                    <i class="fas fa-trophy text-green-600 text-xl mt-1"></i>
                    <span class="text-gray-700">${metric}</span>
                </div>
            `).join('');
            
            // Next Step
            document.getElementById('oppNextStep').textContent = data.next_step;
            
            // Scroll to results
            setTimeout(() => {
                document.getElementById('opportunityResultsCard').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // Back to Employee View
        function backToEmployeeView() {
            document.getElementById('opportunityResultsCard').classList.add('hidden');
            document.getElementById('profileCard').classList.remove('hidden');
            document.getElementById('profileCard').scrollIntoView({ behavior: 'smooth' });
        }

        // Back to SkillsMatch
        function backToSkillsMatch() {
            document.getElementById('opportunityResultsCard').classList.add('hidden');
            currentCardIndex++;
            openSkillsMatch();
        }

        // Initialize
        loadEmployees();
    </script>
</body>
</html>